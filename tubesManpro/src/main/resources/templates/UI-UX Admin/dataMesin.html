<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newci Wash Master - Data Mesin</title>
    <link rel="stylesheet" href="/styleAdmin.css">
    <link rel="stylesheet" href="/DataMesin.css">
    <script defer src="script.js"></script>
</head>

<body>
    <div class="sidebar">
        <h2>Admin Dashboard</h2>
        <nav>
            <ul>
                <li><a th:href="@{/admin}">Data Pegawai</a></li>
                <li><a th:href="@{/UI-UX Admin/dataKecamatan}">Data Kecamatan</a></li>
                <li><a th:href="@{/UI-UX Admin/dataKelurahan}">Data Kelurahan</a></li>
                <li><a th:href="@{/UI-UX Admin/dataPelanggan}">Data Pelanggan</a></li>
                <li><a th:href="@{/UI-UX Admin/dataMesin}">Data Mesin Cuci & Tarif</a></li>
                <li><a th:href="@{/UI-UX Admin/dataTransaksi}">Data Transaksi</a></li>
                <br><br><br><br><br><br><br><br><br><br><br>
                <li id="logout"><a th:href="@{/login}">Log Out</a></li>
            </ul>
        </nav>
    </div>

    <div class="content">
        <header>
            <h1>Selamat Datang, Admin!</h1>
        </header>

        <section id="data-mesin">
            <h2>Data Mesin Cuci & Tarif</h2>
            <button id="tambah-mesin-button" type="button">Tambah Mesin</button>
            <div id="form-tambah-mesin" style="display: none;">
                <h3>Form Tambah Mesin</h3>
                <form id="form-mesin" method="POST" action="/api/mesin/add">
                    <label for="merek">Merek</label>
                    <input type="text" id="merek" name="merek" required>
                    <label for="kapasitas">Kapasitas</label>
                    <input type="number" id="kapasitas" name="kapasitas" required>
                    <label for="tarif">Tarif</label>
                    <input type="number" id="tarif" name="tarif" required>
                    <button type="submit">Simpan</button>
                    <button type="button" id="cancel-mesin-button">Batal</button>
                </form>
            </div>

            <div id="form-update-mesin" style="display: none;">
                <h3>Form Update Mesin</h3>
                <form id="form-update" method="POST">
                    <input type="hidden" id="update-id" name="id">
                    <label for="update-merek">Merek</label>
                    <input type="text" id="update-merek" name="merek" required>
                    <label for="update-kapasitas">Kapasitas</label>
                    <input type="number" id="update-kapasitas" name="kapasitas" required>
                    <label for="update-tarif">Tarif</label>
                    <input type="number" id="update-tarif" name="tarif" required>
                    <button type="submit">Simpan</button>
                    <button type="button" id="cancel-update-button">Batal</button>
                </form>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Merek</th>
                        <th>Kapasitas</th>
                        <th>Tarif</th>
                        <th>Status</th> <!-- Kolom status dengan tombol -->
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="mesin-table-body">
                    <!-- Mesin yang ditambahkan nanti akan muncul di sini -->
                </tbody>
            </table>
        </section>
    </div>

    <script>
        const tambahMesinButton = document.getElementById('tambah-mesin-button');
        const formTambahMesin = document.getElementById('form-tambah-mesin');
        const cancelMesinButton = document.getElementById('cancel-mesin-button');
        const mesinTableBody = document.getElementById('mesin-table-body');

        // Menampilkan form tambah mesin
        tambahMesinButton.addEventListener('click', () => {
            formTambahMesin.style.display = 'block';
            tambahMesinButton.style.display = 'none';
        });

        // Membatalkan form tambah mesin
        cancelMesinButton.addEventListener('click', () => {
            formTambahMesin.style.display = 'none';
            tambahMesinButton.style.display = 'block';
        });

        // Fungsi untuk memuat data mesin
        function loadMesin() {
            fetch('/api/mesin/all')
                .then(response => response.json())
                .then(mesinList => {
                    mesinTableBody.innerHTML = ''; // Clear tabel sebelum mengisi data baru

                    mesinList.forEach(mesin => {
                        const statusClass = mesin.status === 'Available' ? 'Available' : 'NotAvailable';
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${mesin.id}</td>
                            <td>${mesin.merek}</td>
                            <td>${mesin.kapasitas}</td>
                            <td>${mesin.tarif}</td>
                            <td>
                                <button class="status-button ${statusClass}" data-id="${mesin.id}" data-status="${mesin.status}" onclick="toggleStatus(this)">
                                    ${mesin.status === 'Available' ? 'Available' : 'Not Available'}
                                </button>
                            </td>
                            <td>
                                <button class="update-button" data-id="${mesin.id}">Update</button>
                                <button class="delete-button" data-id="${mesin.id}">Delete</button>
                            </td>
                        `;
                        mesinTableBody.appendChild(row);
                    });

                    // Menambahkan event listener untuk tombol update dan delete
                    addUpdateDeleteListeners();
                })
                .catch(error => {
                    console.error('Gagal memuat data mesin:', error);
                });
        }

        // Fungsi untuk menambahkan event listener untuk tombol update dan delete
        function addUpdateDeleteListeners() {
            const updateButtons = document.querySelectorAll('.update-button');
            updateButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const id = button.dataset.id;
                    handleUpdateMesin(id);
                });
            });

            const deleteButtons = document.querySelectorAll('.delete-button');
            deleteButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const id = button.dataset.id;
                    handleDeleteMesin(id);
                });
            });
        }

        // Fungsi untuk toggle status
        function toggleStatus(button) {
            const id = button.dataset.id;
            const currentStatus = button.dataset.status;
            const newStatus = currentStatus === 'Available' ? 'Not Available' : 'Available';

            fetch(`/api/mesin/${id}/status`, {
                method: 'PATCH',
                body: JSON.stringify({ status: newStatus }),
                headers: { 'Content-Type': 'application/json' },
            })
                .then(() => {
                    button.textContent = newStatus;
                    button.dataset.status = newStatus;

                    if (newStatus === 'Available') {
                        button.className = 'status-button Available';
                    } else {
                        button.className = 'status-button NotAvailable';
                    }
                })
                .catch(error => console.error('Gagal memperbarui status mesin:', error));
        }

        // Fungsi untuk menangani update mesin
        function handleUpdateMesin(id) {
            fetch(`/api/mesin/${id}`)
                .then(response => response.json())
                .then(mesin => {
                    document.getElementById('update-id').value = mesin.id;
                    document.getElementById('update-merek').value = mesin.merek;
                    document.getElementById('update-kapasitas').value = mesin.kapasitas;
                    document.getElementById('update-tarif').value = mesin.tarif;

                    document.getElementById('form-update-mesin').style.display = 'block';
                })
                .catch(error => console.error('Gagal memuat data mesin:', error));
        }

        // Fungsi untuk menangani hapus mesin
        function handleDeleteMesin(id) {
            if (confirm('Apakah Anda yakin ingin menghapus mesin ini?')) {
                fetch(`/api/mesin/${id}`, { method: 'DELETE' })
                    .then(() => {
                        loadMesin(); // Refresh data mesin setelah dihapus
                    })
                    .catch(error => console.error('Gagal menghapus mesin:', error));
            }
        }

        // Memuat data mesin saat halaman pertama kali dimuat
        loadMesin();
    </script>
</body>

</html>